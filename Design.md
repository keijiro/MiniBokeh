# プロジェクトの目標

このプロジェクトでは比較的軽量な DoF (depth of field) エフェクトを Unity URP の Renderer Feature として実装することを目標とします。

# コンセプト

通常の DoF エフェクトは、per-pixel でのデプス情報を処理する必要があることや、非常に多くのテクスチャサンプリングを行う必要があることから、ポストプロセスとしては非常に重い部類に入ります。

このプロジェクトでは、DoF エフェクトをいくつかの点で簡略化することで、その軽量化を図ります。

- **デプス情報を使用しない** - この DoF エフェクトではデプス情報を使わずに、Reference Plane という平面をパラメーターとして与え、この平面から導かれるデプス値を DoF における CoC (circle of confusion) の算出に用います。要するに、画面上の全てのピクセルはこの Reference Plane の上に存在する、という大胆な簡略化を行うわけです。これは、全てのオブジェクトが地面や平面の上に配置されるストラテジーゲームやテーブルゲームでは許容できる簡略化になります。

- **Separable Bokeh アプローチの使用** - DiPaolaMcIntoshRiecke2012.pdf に記された Separable Bokeh アプローチを用います。これによりテクスチャサンプルの総回数を大幅に減らすことができます。このアプローチは per-pixel なデプス情報を用いる場合にはアーティファクトを生じる欠点がありますが、このプロジェクトのようにデプスが常に連続しているならば、アーティファクトが生じる可能性は低いと考えられます。

# 実装方法

ベースとなる実装を Assets/MiniatureBokeh 内に用意してあります。これを書き換える形でエフェクトの実装を行なってください。

この実装では、エフェクトのレンダーパイプライン関係の処理は MiniatureBokehFeature.cs 内に実装しつつ、ユーザーがリアルタイムに操作するパラメーターは MiniatureBokehController.cs 内に実装する、と言うような住み分けを行なっています。

# エフェクトパラメーター

URP には Physical Camera 設定が存在しますが、これはあまり積極的に使用されない傾向にあります。そのため、このエフェクトでは Physical Camera 設定を参照せず、独自のパラメーターを持つことにします。

まず、Auto Focus スイッチを持ちます。これはカメラの中心軸と Reference Plane の交点にフォーカスを合わせる機能で、これが有効な場合は Focus Distance の設定は無効になります。

次に Focus Distance フィールドを持ちます。これはカメラからどの距離にフォーカスを合わせるかという設定です。

あとはボケ量を調整するパラメーターが必要になりますが、これは実装を進めていく過程で必要になったものを追加してください。

# Separable Bokeh アプローチについて

このプロジェクトでは実装の比較的容易な６角形 (Hex) 形状の apature のみを扱う事とします。
